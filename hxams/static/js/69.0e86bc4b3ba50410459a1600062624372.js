webpackJsonp([69],{"19ix":function(e,t,o){var a=o("fzsG");"string"==typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);o("rjj0")("272efc38",a,!1,{})},FPqy:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=o("cMGX"),r=o("mvHQ"),i=o.n(r),n=o("JoXd"),l=o("KerB"),s={name:"Book",components:{FileSelection:n.a,ApplyTypeSelect:l.a},props:["bookObj"],data:function(){var e=this;return{chioceFileVisible:!1,borrowForm:{id:"",appointor:"",appointDate:"",appointStartDate:"",appointEndDate:"",applyTypeId:"",appointorDep:"",contactWay:"",IDNumber:"",describe:"",fileID:"",fileName:""},pageType:"add",chioceFileData:[],rules:{appointor:[{required:!0,message:"请输入预约人",trigger:"blur"},{min:2,max:30,message:"长度在 2 到 30 个字符",trigger:"blur"}],appointorDep:[{required:!0,message:"请输入预约人部门",trigger:"blur"},{min:2,max:30,message:"长度在 2 到 30 个字符",trigger:"blur"}],contactWay:[{required:!0,message:"请输入联系方式",trigger:"blur"},{validator:function(e,t,o){0==/^1[3456789]\d{9}$/.test(t)?o(new Error("联系方式无效!")):o()},trigger:"blur"}],applyTypeId:[{required:!0,message:"请选择查借阅类型",trigger:"change"}],appointDate:[{required:!0,message:"请选择预约起始时间",trigger:["change","blur"]},{validator:function(e,t,o){o()},trigger:"change"}],IDNumber:[{required:!0,message:"请输入身份证号",trigger:"blur"},{validator:function(t,o,a){0==e.commonFun.checkIdCard(o)?a(new Error("身份证号无效!")):a()},trigger:"blur"}],describe:[{required:!1,message:"请输入详细描述",trigger:"blur"}]}}},created:function(){"{}"!==i()(this.bookObj)?(this.pageType="edit",this.setFormData(),this.getFilesById()):this.pageType="add"},mounted:function(){},computed:{},methods:{ApplyTypeCall:function(e){this.borrowForm.applyTypeId=e},setFormData:function(){this.borrowForm.id=this.bookObj.id,this.borrowForm.appointor=this.bookObj.appointor,this.borrowForm.appointStartDate=this.bookObj.appointstartdate,this.borrowForm.appointEndDate=this.bookObj.appointenddate,this.borrowForm.applyTypeId=this.bookObj.applyTypeId,this.borrowForm.appointorDep=this.bookObj.appointordep,this.borrowForm.contactWay=this.bookObj.contactway,this.borrowForm.IDNumber=this.bookObj.idnumber,this.borrowForm.describe=this.bookObj.describe,this.borrowForm.appointDate=[new Date(this.bookObj.appointstartdate),new Date(this.bookObj.appointenddate)]},getFilesById:function(){var e=this;this.$axios({loading:{isShow:!0,target:".book"},method:"get",url:this.API.getA01ByBorrowAndReadId,params:{id:this.bookObj.id}}).then(function(t){var o=t.data;"1"==o.code?(e.chioceFileData=o.data,e.concatParams(e)):e.$message({type:"error",message:"查询档案人员信息失败，请刷新重试！"})}).catch(function(t){e.$message({type:"error",message:"请求异常，请检查网络！"})})},getDate:function(e){e&&2==e.length&&(this.borrowForm.appointStartDate=e[0],this.borrowForm.appointEndDate=e[1])},addBook:function(e){var t=this;this.$refs[e].validate(function(e){if(t.chioceFileData.length<1)t.$message({type:"warning",message:"您还没有选择档案!"});else{if(!e)return!1;var o={appointor:t.borrowForm.appointor,appointstartdate:t.borrowForm.appointStartDate,appointenddate:t.borrowForm.appointEndDate,applytype:t.borrowForm.applyTypeId,appointordep:t.borrowForm.appointorDep,contactway:t.borrowForm.contactWay,idnumber:t.borrowForm.IDNumber,describe:t.borrowForm.describe,a0100:t.borrowForm.fileID,name:t.borrowForm.fileName};t.$axios({loading:{isShow:!0,target:".book"},method:"post",url:t.API.addBorrowAndRead,data:o}).then(function(e){"1"==e.data.code?(t.$message({type:"success",message:"预约成功!"}),t.resetForm(),t.$emit("BookCallBack",!0)):t.$message({type:"error",message:"预约失败，请退出重试！"})}).catch(function(e){t.$message({type:"error",message:"请求异常，请检查网络！"})})}})},editBook:function(e){var t=this;this.$refs[e].validate(function(e){if(t.chioceFileData.length<1)t.$message({type:"warning",message:"您还没有选择档案!"});else{if(!e)return!1;var o={id:t.borrowForm.id,appointor:t.borrowForm.appointor,appointstartdate:t.borrowForm.appointStartDate,appointenddate:t.borrowForm.appointEndDate,applytype:t.borrowForm.applyTypeId,appointordep:t.borrowForm.appointorDep,contactway:t.borrowForm.contactWay,idnumber:t.borrowForm.IDNumber,describe:t.borrowForm.describe,a0100:t.borrowForm.fileID,name:t.borrowForm.fileName};t.$axios({loading:{isShow:!0,target:".book"},method:"post",url:t.API.updateBorrowAndRead,data:o}).then(function(e){"1"==e.data.code?(t.$message({type:"success",message:"预约修改成功!"}),t.resetForm(),t.$emit("BookCallBack",!0)):t.$message({type:"error",message:"预约修改失败，请退出重试！"})}).catch(function(e){t.$message({type:"error",message:"请求异常，请检查网络！"})})}})},cancelBook:function(){this.resetForm(),this.$emit("BookCallBack",!1)},resetForm:function(){this.pageType="add",this.chioceFileVisible=!1,this.chioceFileData=[],this.$refs.borrowForm.resetFields()},getChioceFiles:function(e){this.chioceFileData=this.commonFun.concatArray(this.chioceFileData,e,"a0100"),this.concatParams(this),this.chioceFileVisible=!1},delFileOwner:function(e,t){this.chioceFileData.splice(e,1),this.concatParams(this)},concatParams:function(e){var t="",o="";e.chioceFileData.forEach(function(e,a,r){a==r.length-1?(t+=e.a0100,o+=e.a0101):(t+=e.a0100+",",o+=e.a0101+" ")}),e.borrowForm.fileID=t,e.borrowForm.fileName=o}}},p=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"book"},[o("el-form",{ref:"borrowForm",staticClass:"demo-ruleForm",attrs:{model:e.borrowForm,rules:e.rules,"label-width":"100px",size:"small"}},[o("el-row",{attrs:{gutter:15}},[o("el-col",{attrs:{span:13}},[o("el-form-item",{attrs:{label:"预约人部门",prop:"appointorDep"}},[o("el-input",{attrs:{placeholder:"请输入预约人部门"},model:{value:e.borrowForm.appointorDep,callback:function(t){e.$set(e.borrowForm,"appointorDep",t)},expression:"borrowForm.appointorDep"}})],1)],1),e._v(" "),o("el-col",{attrs:{span:10}},[o("el-form-item",{attrs:{label:"预约人",prop:"appointor"}},[o("el-input",{attrs:{placeholder:"请输入预约人"},model:{value:e.borrowForm.appointor,callback:function(t){e.$set(e.borrowForm,"appointor",t)},expression:"borrowForm.appointor"}})],1)],1),e._v(" "),o("el-col",{attrs:{span:13}},[o("el-form-item",{attrs:{label:"查借阅类型",prop:"applyTypeId"}},[o("div",{staticClass:"applyTypeIdSelect"},[o("ApplyTypeSelect",{attrs:{chioceOptionId:e.borrowForm.applyTypeId},on:{ApplyTypeCall:e.ApplyTypeCall}})],1)])],1),e._v(" "),o("el-col",{attrs:{span:10}},[o("el-form-item",{attrs:{label:"联系方式",prop:"contactWay"}},[o("el-input",{attrs:{placeholder:"请输入联系方式"},model:{value:e.borrowForm.contactWay,callback:function(t){e.$set(e.borrowForm,"contactWay",t)},expression:"borrowForm.contactWay"}})],1)],1),e._v(" "),o("el-col",{attrs:{span:13}},[o("el-form-item",{attrs:{label:"预约时间",prop:"appointDate"}},[o("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"daterange","range-separator":"至","start-placeholder":"选择预约开始日期","end-placeholder":"选择预约结束日期","value-format":"yyyy-MM-dd"},on:{blur:e.getDate,change:e.getDate},model:{value:e.borrowForm.appointDate,callback:function(t){e.$set(e.borrowForm,"appointDate",t)},expression:"borrowForm.appointDate"}})],1)],1),e._v(" "),o("el-col",{attrs:{span:10}},[o("el-form-item",{attrs:{label:"身份证号",prop:"IDNumber"}},[o("el-input",{attrs:{placeholder:"请输入身份证号"},model:{value:e.borrowForm.IDNumber,callback:function(t){e.$set(e.borrowForm,"IDNumber",t)},expression:"borrowForm.IDNumber"}})],1)],1),e._v(" "),o("el-col",{attrs:{span:23}},[o("el-form-item",{attrs:{label:"详细描述",prop:"describe"}},[o("el-input",{attrs:{type:"textarea",autosize:{minRows:1,maxRows:2}},model:{value:e.borrowForm.describe,callback:function(t){e.$set(e.borrowForm,"describe",t)},expression:"borrowForm.describe"}})],1)],1)],1)],1),e._v(" "),o("el-row",[o("el-col",{attrs:{span:23}},[o("el-button",{attrs:{type:"primary"},on:{click:function(t){e.chioceFileVisible=!0}}},[e._v("选择档案")])],1)],1),e._v(" "),o("el-row",[o("el-col",{attrs:{span:23}},[o("el-table",{staticClass:"chioceFileTable",attrs:{data:e.chioceFileData,"empty-text":"暂无数据，请先选择档案",border:"",height:"190px"}},[o("el-table-column",{attrs:{fixed:"right",label:"操作",width:"80",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("el-button",{attrs:{type:"text"},on:{click:function(o){e.delFileOwner(t.$index,t.row)}}},[e._v("删除")])]}}])}),e._v(" "),o("el-table-column",{attrs:{type:"index",label:"序号",width:"50",align:"center"}}),e._v(" "),o("el-table-column",{attrs:{prop:"a0101",label:"姓名",width:"100",align:"center"}}),e._v(" "),o("el-table-column",{attrs:{prop:"a0104",label:"性别",width:"80",align:"center"}}),e._v(" "),o("el-table-column",{attrs:{prop:"a0107",label:"出生年月",width:"100",align:"center"}}),e._v(" "),o("el-table-column",{attrs:{prop:"a0117",label:"民族",width:"140",align:"center"}}),e._v(" "),o("el-table-column",{attrs:{prop:"a0111a",label:"籍贯",align:"center"}})],1)],1)],1),e._v(" "),o("el-dialog",{directives:[{name:"dialogDrag",rawName:"v-dialogDrag"}],attrs:{width:"750px",height:"500px",title:"档案选择",visible:e.chioceFileVisible,"append-to-body":"","close-on-click-modal":!1},on:{"update:visible":function(t){e.chioceFileVisible=t}}},[o("FileSelection",{on:{GetChioceFiles:e.getChioceFiles}})],1),e._v(" "),o("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},["add"==e.pageType?o("el-button",{attrs:{type:"primary"},on:{click:function(t){e.addBook("borrowForm")}}},[e._v("立即预约")]):"edit"==e.pageType?o("el-button",{attrs:{type:"primary"},on:{click:function(t){e.editBook("borrowForm")}}},[e._v("立即保存")]):e._e(),e._v(" "),o("el-button",{on:{click:e.cancelBook}},[e._v("取 消")])],1)],1)};p._withStripped=!0;var c={render:p,staticRenderFns:[]},d=c;var m=!1;var b=o("VU/8")(s,d,!1,function(e){m||o("19ix")},"data-v-65031333",null);b.options.__file="src/views/archivalBorrowing/Book.vue";var h=b.exports,g={name:"BorrowingBook",components:{Pagination:a.a,Book:h,ApplyTypeSelect:l.a},data:function(){return{bSetTableHeight:!1,tableHeight:window.innerHeight-70-52-5,tableData:[],pageObj:{pageIndex:this.API.constObj.pageIndex,total:0,pageSize:this.API.constObj.pageSize},editBook:{},multipleSelection:[],bookVisible:!1,dialogTitle:"查借预约",searchForm:{appointor:"",appointStartDate:"",appointEndDate:"",applyType:""}}},created:function(){},mounted:function(){this.getData()},watch:{bSetTableHeight:function(e,t){this.tableHeight=window.innerHeight-this.$refs.multipleTable.$el.offsetTop-70-52-5}},methods:{handleCurrentChange:function(e){this.pageObj.pageIndex=e,this.getData()},PageTurning:function(e){this.pageObj.pageIndex=e.page_index,this.pageObj.pageSize=e.page_size,this.getData()},BookCallBack:function(e){this.bookVisible=!1,e&&this.getData()},ApplyTypeCall:function(e){this.searchForm.applyType=e},startDateChange:function(){var e=this.searchForm.appointStartDate,t=this.searchForm.appointEndDate;e&&e.length>0&&t&&t.length>0&&(new Date(e).getTime()>new Date(t).getTime()&&(this.$message({type:"error",message:"预约开始日期不能大于结束日期!"}),this.searchForm.appointStartDate=""))},endDateChange:function(){var e=this.searchForm.appointStartDate,t=this.searchForm.appointEndDate;e&&e.length>0&&t&&t.length>0&&(new Date(e).getTime()>new Date(t).getTime()&&(this.$message({type:"error",message:"预约开始日期不能大于结束日期!"}),this.searchForm.appointEndDate=""))},getData:function(){var e=this;this.$axios({loading:{isShow:!0,target:".borrowingBook"},method:"post",url:this.API.getBorrowAndReadAppointList,data:{appointor:this.searchForm.appointor,applyType:this.searchForm.applyType,appointStartDate:this.searchForm.appointStartDate,appointEndDate:this.searchForm.appointEndDate,pageIndex:this.pageObj.pageIndex,pageSize:this.pageObj.pageSize}}).then(function(t){var o=t.data;e.bSetTableHeight=!0,"1"==o.code?(e.tableData=o.data.list,e.pageObj.total=o.data.total):e.$message({type:"error",message:"查询失败，请刷新重试！"})}).catch(function(t){e.$message({type:"error",message:"请求异常，请检查网络！"})})},dateFormat:function(e,t,o,a){return this.commonFun.dateFormat(o,"yyyy-MM-dd")},search:function(){this.pageObj.pageIndex=this.API.constObj.pageIndex,this.getData()},book:function(){this.editBook={},this.dialogTitle="查借预约",this.bookVisible=!0},handleEdit:function(e,t){this.editBook=this.tableData[e],this.dialogTitle="预约编辑",this.bookVisible=!0},handleBook:function(e,t){var o=this.tableData[e],a=this;this.$confirm("确定要进行登记处理吗?","操作提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){a.bookData(o.id,a)}).catch(function(){})},bookData:function(e,t){t.$axios({loading:{isShow:!0,target:".borrowingBook"},method:"post",url:t.API.borrowAndReadRegister,data:{id:e}}).then(function(e){var o=e.data;"1"==o.code?(t.$message({type:"success",message:"登记处理成功!"}),t.getData()):"10"==o.code?t.$alert(o.message+"无法登记处理，请重新预约。","信息提示"):t.$message({type:"error",message:"登记处理失败，请刷新重试！"})}).catch(function(e){t.$message({type:"error",message:"请求异常，请检查网络！"})})}}},u=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"borrowingBook"},[o("div",{staticClass:"container"},[o("el-form",{staticClass:"demo-form-inline",attrs:{inline:!0,model:e.searchForm}},[o("el-form-item",[o("el-button",{attrs:{type:"primary",icon:"el-icon-edit"},on:{click:e.book}},[e._v("预约")])],1),e._v(" "),o("el-form-item",[o("el-input",{attrs:{placeholder:"输入预约人"},model:{value:e.searchForm.appointor,callback:function(t){e.$set(e.searchForm,"appointor",t)},expression:"searchForm.appointor"}})],1),e._v(" "),o("el-form-item",[o("el-date-picker",{staticStyle:{width:"180px"},attrs:{type:"date","value-format":"yyyy-MM-dd",placeholder:"预约开始日期"},on:{change:e.startDateChange},model:{value:e.searchForm.appointStartDate,callback:function(t){e.$set(e.searchForm,"appointStartDate",t)},expression:"searchForm.appointStartDate"}})],1),e._v(" "),o("el-form-item",[o("el-date-picker",{staticStyle:{width:"180px"},attrs:{type:"date","value-format":"yyyy-MM-dd",placeholder:"预约结束日期"},on:{change:e.endDateChange},model:{value:e.searchForm.appointEndDate,callback:function(t){e.$set(e.searchForm,"appointEndDate",t)},expression:"searchForm.appointEndDate"}})],1),e._v(" "),o("el-form-item",[o("div",{staticClass:"applyTypeSelect"},[o("ApplyTypeSelect",{on:{ApplyTypeCall:e.ApplyTypeCall}})],1)]),e._v(" "),o("el-form-item",[o("el-button",{attrs:{type:"primary",icon:"search"},on:{click:e.search}},[e._v("查询")])],1)],1),e._v(" "),o("el-table",{ref:"multipleTable",staticClass:"table",attrs:{data:e.tableData,border:"",height:e.tableHeight}},[o("el-table-column",{attrs:{fixed:"right",label:"操作",width:"140",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[2==t.row.status?o("el-button",{staticClass:"gray",attrs:{type:"text"}},[e._v("编辑")]):o("el-button",{attrs:{type:"text"},on:{click:function(o){e.handleEdit(t.$index,t.row)}}},[e._v("编辑")]),e._v(" "),2==t.row.status?o("el-button",{staticClass:"gray",attrs:{type:"text"}},[e._v("登记处理")]):o("el-button",{attrs:{type:"text"},on:{click:function(o){e.handleBook(t.$index,t.row)}}},[e._v("登记处理")])]}}])}),e._v(" "),o("el-table-column",{attrs:{type:"index",label:"序号",align:"center",width:"50"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e.pageObj.pageIndex*e.pageObj.pageSize+t.$index+1)+" ")]}}])}),e._v(" "),o("el-table-column",{attrs:{prop:"appointor",label:"预约人",sortable:"","min-width":"100",align:"center"}}),e._v(" "),o("el-table-column",{attrs:{prop:"appointordep",label:"预约人部门","min-width":"180","header-align":"center",align:"left","show-overflow-tooltip":""}}),e._v(" "),o("el-table-column",{attrs:{prop:"appointstartdate",label:"预约开始时间",sortable:"",width:"130",align:"center",formatter:e.dateFormat}}),e._v(" "),o("el-table-column",{attrs:{prop:"appointenddate",label:"预约结束时间",sortable:"",width:"130",align:"center",formatter:e.dateFormat}}),e._v(" "),o("el-table-column",{attrs:{prop:"applyType",label:"查借阅类型",sortable:"",width:"120",align:"center","show-overflow-tooltip":""}}),e._v(" "),o("el-table-column",{attrs:{prop:"contactway",label:"联系方式",width:"120",align:"center"}}),e._v(" "),o("el-table-column",{attrs:{prop:"idnumber",label:"身份证号",width:"170",align:"center","show-overflow-tooltip":""}}),e._v(" "),o("el-table-column",{attrs:{prop:"archnames",label:"档案名称集合","min-width":"160","header-align":"center",align:"left","show-overflow-tooltip":""}}),e._v(" "),o("el-table-column",{attrs:{prop:"describe",label:"详细描述","min-width":"170","header-align":"center",align:"left","show-overflow-tooltip":""}})],1),e._v(" "),o("Pagination",{attrs:{pageIndex:e.pageObj.pageIndex,total:e.pageObj.total,pageSize:e.pageObj.pageSize},on:{PageTurning:e.PageTurning}})],1),e._v(" "),e.bookVisible?o("el-dialog",{directives:[{name:"dialogDrag",rawName:"v-dialogDrag"}],staticClass:"outDialog",attrs:{title:e.dialogTitle,visible:e.bookVisible,width:"800px","append-to-body":"","close-on-click-modal":!1},on:{"update:visible":function(t){e.bookVisible=t}}},[o("Book",{attrs:{bookObj:e.editBook},on:{BookCallBack:e.BookCallBack}})],1):e._e()],1)};u._withStripped=!0;var f={render:u,staticRenderFns:[]},w=f;var y=!1;var F=o("VU/8")(g,w,!1,function(e){y||o("ZAku")},"data-v-3ca7dbfc",null);F.options.__file="src/views/archivalBorrowing/BorrowingBook.vue";t.default=F.exports},ZAku:function(e,t,o){var a=o("m53n");"string"==typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);o("rjj0")("62afdd33",a,!1,{})},fzsG:function(e,t,o){(e.exports=o("FZ+f")(!1)).push([e.i,"\n.book .el-row .el-col .chioceFileTable[data-v-65031333] {\n  margin: 10px 0 10px 0;\n}\n.book .el-row .el-col .el-date-picker[data-v-65031333] {\n  width: 200px;\n}\n.book .dialog-footer[data-v-65031333] {\n  text-align: center;\n}\n",""])},m53n:function(e,t,o){(e.exports=o("FZ+f")(!1)).push([e.i,"\nel-dialog .del-dialog-cnt[data-v-3ca7dbfc] {\n  font-size: 16px;\n  text-align: center;\n}\n.borrowingBook[data-v-3ca7dbfc] {\n  min-width: 1126px;\n  width: 100%;\n  font-size: 14px;\n}\n.gray[data-v-3ca7dbfc] {\n  color: #dcdfe6;\n}\n.red[data-v-3ca7dbfc] {\n  color: #ff0000;\n}\n",""])}});